<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Verilog Online Playground</title>
  <script src="https://cdn.jsdelivr.net/npm/wavedrom@2.9.1/wavedrom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/verilog.js@latest/dist/verilog.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #1e1e1e; color: #ddd; }
    textarea { width: 48%; height: 250px; background: #2b2b2b; color: #eee; border: none; padding: 8px; font-family: monospace; }
    #controls { margin: 10px 0; }
    #output { background: #111; padding: 10px; height: 150px; overflow-y: auto; white-space: pre; border: 1px solid #333; }
    #waveform { background: #fff; margin-top: 20px; padding: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ§  Verilog Browser Playground (iverilog-like)</h2>

  <div>
    <h3>Main Module(s)</h3>
    <textarea id="code">// Example module
module adder(input [3:0] a, b, output [4:0] sum);
  assign sum = a + b;
endmodule
</textarea>

    <h3>Testbench</h3>
    <textarea id="tb">// Example testbench
module tb;
  reg [3:0] a, b;
  wire [4:0] sum;
  adder uut(a, b, sum);
  initial begin
    $dumpvars;
    a=0; b=0;
    #5 a=3; b=4;
    #5 a=9; b=5;
    #5 $finish;
  end
endmodule
</textarea>
  </div>

  <div id="controls">
    <button onclick="runSim()">â–¶ Run Simulation</button>
  </div>

  <h3>Simulation Output:</h3>
  <div id="output"></div>

  <h3>Waveform:</h3>
  <div id="waveform">
    <script type="WaveDrom">
    { signal: [] }
    </script>
  </div>

  <script>
    async function runSim() {
      const code = document.getElementById('code').value;
      const tb = document.getElementById('tb').value;
      const output = document.getElementById('output');
      output.textContent = 'Running simulation...';

      try {
        const verilogCode = code + '\n' + tb;
        const sim = new Verilog();
        const result = await sim.run(verilogCode);

        output.textContent = result.output || 'Simulation complete (no text output).';

        if (result.waveform && result.waveform.length > 0) {
          document.getElementById('waveform').innerHTML =
            '<script type="WaveDrom">{"signal": ' +
            JSON.stringify(result.waveform) + '}</' + 'script>';
          WaveDrom.ProcessAll();
        } else {
          document.getElementById('waveform').innerHTML = '<em>No waveform data</em>';
        }
      } catch (e) {
        output.textContent = 'Error: ' + e.message;
      }
    }
  </script>
</body>
</html>
